<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unit Tests</title>

	<!-- <script type="module" src="ATestRunner.js"></script> -->
  <script type="module" src="t-runner.test.js"></script>

	<script>
    class CustomElement extends HTMLElement {
      // Attributes
      #myInput = 'foo';
      #mySelect = 'foo';
      #mySelectmulti = ['foo', 'bar'];
      #myCheckbox = 'foo';
      #myRadiogroup = 'foo';
      #myButton = 'foo';
      #someAttr = 'attr value';

      // Not Attributes
      isDisabled = true;
      myFileInput;
      options = ['foo', 'bar', 'baz'];

      static observedAttributes = [
        'my-input',
        'my-select',
        'my-selectmulti',
        'my-checkbox',
        'my-radiogroup',
        'my-button',
        'some-attr'
      ];

      constructor() { super(); }

      attributeChangedCallback(attr, oldval, newval) {
        const property = attr.replace(/-(\w)/g, (_, c) => c.toUpperCase());

        switch (attr) {
          case "my-input": this.#myInput = newval; break;
          case "my-select": this.#mySelect = newval; break;
          case "my-selectmulti":
            newval = newval.split(/[,\s]+/g);
            this.#mySelectmulti = newval;
            break;
          case "my-checkbox": this.#myCheckbox = newval; break
          case "my-radiogroup": this.#myRadiogroup = newval; break;
          case "my-button": this.#myButton = newval; break;
          case "some-attr": this.#someAttr = newval; break;
        }

        // if (window.abind) abind.update(this, property, newval);
      }

      buildOptionList(options) {
        let str = "";
        for (const value of options) {
          str += `<option value="${value}">${value}</option>\n`;
        }

        return str;
      }

      handleFiles(event) {
        const files = event.target.files;
        const arr = [];
        this.myFileInput = files;
        for (const file of files) {
          arr.push({
            name: file.name,
            type: file.type,
            size: file.size,
            modified: file.lastModified
          })
        };
        alert(`Files: ${JSON.stringify(arr, null, 2)}`)
      }

      handleClick(event) {
        const value = event.target.value;
        const other = event.target.dataset.other;
        const msg = `
          Context (this): ${this.constructor.name}
          Function: handleClick ( event )
          Event passed: ${event}
          event.target: ${event.target}
          event.target.value: " ${value} "
          event.target.dataset.other: " ${other} "
        `;

        alert(msg);
      }

      setOption(event) {
        const value = event.target.value;
        const property = event.target.dataset.property;
        this[property] = value;
      }

      get myInput() { return this.#myInput }
      set myInput(value) { this.setAttribute('my-input', value) }

      get mySelect() { return this.#mySelect }
      set mySelect(value) {
        this.setAttribute('my-select', value)
      }

      get mySelectmulti() { return this.#mySelectmulti }
      set mySelectmulti(value) {
          value = value.join(',');
          this.setAttribute('my-selectmulti', value)
      }

      get myCheckbox() { return this.#myCheckbox }
      set myCheckbox(value) { this.setAttribute('my-checkbox', value) }

      get myRadiogroup() { return this.#myRadiogroup; }
      set myRadiogroup(value) { this.setAttribute('my-radiogroup', value)}

      get myButton() { return this.#myButton }
      set myButton(value) {
        value = value || this.#myButton;
        this.setAttribute('my-button', value)
      }

      get someAttr() { return this.#someAttr }
      set someAttr(value) { this.setAttribute('some-attribute', value) }

      // not attributes
      get myDynamicOptions() {
        return this.buildOptionList(this.options)
      }

      set myDynamicOptions(value) {
        const options1 = ['foo', 'bar', 'baz'];
        const options2 = ['one', 'two', 'three'];

        if (JSON.stringify(this.options) === JSON.stringify(options1)) {
          this.options = options2;
        } else {
          this.options = options1;
        }

        if (window.abind) abind.update(this, 'myDynamicOptions', this.myDynamicOptions);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      customElements.define('custom-element', CustomElement);
    });
  </script>
</head>
<body>
	<custom-element></custom-element>
	<a-testrunner all open file="src/a-bind.js">
	</a-testrunner>
</body>
</html>
